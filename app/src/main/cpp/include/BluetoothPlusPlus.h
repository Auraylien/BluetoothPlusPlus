#ifndef BLUETOOTH_BLUETOOTHPLUSPLUS_H
#define BLUETOOTH_BLUETOOTHPLUSPLUS_H

#include <cstdint>
#include <sys/types.h>

#if defined(__aarch64__)
    #define LIBC_PATH_OLD           "/system/lib64/libc.so"
    #define LIBC_PATH_NEW           "/apex/com.android.runtime/lib64/bionic/libc.so"
    #define LIBRARY_PATH            "/system/system_ext/lib64/libbluetooth_qti.so"
    #define SIGNATURE_GET_DEV_CLASS "\xff\x83\x01\xd1\x5e\x86\x00\xf8\xfd\x7b\x01\xa9\xf9\x13\x00\xf9\xf8\x5f\x03\xa9\xf6\x57\x04\xa9\xf4\x4f\x05\xa9\xfd\x43\x00\x91\x56\xd0\x3b\xd5\xc8\x16\x40\xf9\xf3\x03\x00\xaa\xe8\x07\x00\xf9\x08\x00\x40\xb9\x1f\x21\x00\x71\xe0\x09\x00\x54\x1f\x0d\x00\x71\x80\x03\x00\x54\x1f\x09\x00\x71\x61\x0c\x00\x54\x75\x06\x40\xf9\x9a\xc0\xfd\x97\x08\x00\x40\xf9\xf4\x03\x00\xaa\x00\x01\x3f\xd6\x01\xf2\xff\xf0\x21\xa4\x09\x91\xe0\x10\x00\x36\x02\xf2\xff\xf0\x63\xf3\xff\xf0\x42\xe4\x09\x91\x63\x70\x36\x91\xc0\x00\x80\x52\xd7\x00\x80\x52\xe6\x16\x06\x94\x88\x06\x40\xf9\x00\x01\x3f\xd6\xe8\x03\x00\xaa\x09\x01\x40\xb9\x08\x09\x40\x79\xe0\x03\x1f\x2a\xa9\x02\x00\xb9\xa8\x0a\x00\x79\x77\x06\x00\xb9\x86\x00\x00\x14\x75\x06\x40\xf9\x51\xf0\xfe\x97\xf4\x03\x00\xaa\x01\xf2\xff\xf0\x62\xf2\xff\xd0\x63\xf3\xff\xf0\x21\xa4\x09\x91\x42\x3c\x36\x91\x63\x70\x36\x91\x80\x00\x80\x52\xe4\x03\x14\xaa\xd0\x16\x06\x94\xf9\xf4\xff\xd0\xf7\x03\x1f\x2a\xf8\x03\x1f\xaa\x39\x23\x33\x91\x09\x00\x00\x14\x40\x21\x82\x52\x7c\x12\x06\x94\xa8\x52\x37\x8b\xf7\x06\x00\x11\x00\x05\x00\xa9\x18\x07\x00\x91\x1f\x8b\x00\xf1\xa0\x02\x00\x54\x88\x26\xd8\x9a\x88\xff\x07\x36\x08\x0f\x00\xd1\x1f\x55\x00\xf1\x28\xff\xff\x54\x69\xfe\xff\x10\x2a\x6b\x68\x38\x29\x09\x0a\x8b\x20\x01\x1f\xd6\xe0\x23\x82\x52\x6b\x12\x06\x94\xa8\x52\x37\x8b\xf7\x06\x00\x11\x00\x05\x00\xa9\x40\x22\x82\x52\xea\xff\xff\x17\x60\x21\x82\x52\xe8\xff\xff\x17\xc0\x23\x82\x52\xe6\xff\xff\x17\xe8\x6e\x1c\x53\xe0\x03\x1f\x2a\x68\x06\x00\xb9\x55\x00\x00\x14\x80\x0c\x00\xb0\x00\xb0\x43\xf9\x30\x1d\x04\x94\xf4\x03\x00\xaa\xe0\x03\x00\xf9\xe0\x03\x00\x91\xe1\x03\x1f\x2a\x7f\x06\x00\xb9\x59\x00\x00\x94\x88\x0c\x00\xb0\x08\x81\x42\xf9\xe0\x03\x14\xaa\x15\x01\x40\x39\x7b\x1e\x04\x94\xe1\xf3\xff\xf0\x62\xf3\xff\xf0\xbf\x16\x00\x71\xe3\x03\x00\xaa\x21\xf0\x05\x91\x42\x70\x36\x91\x80\xa0\x80\x52\x23\x01\x00\x54\x52\x0a\xfc\x97\x08\x00\x00\x14\xe0\x03\x1f\xaa\xe1\x03\x13\xaa\x38\x01\x00\x94\xe0\x06\x00\x34\xe0\x03\x1f\x2a\x37\x00\x00\x14\xc3\x0a\xfc\x97\xe0\x03\x14\xaa\x68\x1e\x04\x94\xe0\x03\x00\xb4\xe0\x03\x14\xaa\x65\x1e\x04\x94\x08\x04\x00\x0b\x08\x79\x1f\x53\x00\x7d\x40\x93\x68\x06\x00\xb9\x9d\x10\x04\x94\xf5\x03\x00\xaa\x60\x06\x00\xf9\xe0\x03\x14\xaa\xdf\x1d\x04\x94\xf3\x03\x00\xaa\xe0\x03\x14\xaa\xfc\x1d\x04\x94\x7f\x02\x00\xeb\xe0\x01\x00\x54\xe0\x03\x13\xaa\x15\x1e\x04\x94\x08\x00\x40\xb9\x09\x08\x40\x79\xe0\x03\x13\xaa\xa8\x02\x00\xb9\xa9\x0a\x00\x79\x2f\x1e\x04\x94\xf3\x03\x00\xaa\xe0\x03\x14\xaa\xef\x1d\x04\x94\x7f\x02\x00\xeb\xb5\x1a\x00\x91\x61\xfe\xff\x54\xe0\x03\x14\xaa\x01\x1d\x04\x94\xe0\x03\x1f\x2a\x11\x00\x00\x14\x82\xf4\xff\xf0\x63\xf3\xff\xd0\x42\xf4\x09\x91\x63\x70\x36\x91\xc0\x00\x80\x52\x61\x16\x06\x94\x88\x0c\x00\x90\x08\x8d\x42\xf9\x20\x00\x80\x52\x09\x01\x40\xb9\x08\x09\x40\x79\xa9\x02\x00\xb9\xa8\x0a\x00\x79\x03\x00\x00\x14\xe0\x03\x13\xaa\xd5\x06\xff\x97\xc8\x16\x40\xf9\xe9\x07\x40\xf9\x1f\x01\x09\xeb\x21\x01\x00\x54\xfd\x7b\x41\xa9\xf4\x4f\x45\xa9\xf6\x57\x44\xa9\xf8\x5f\x43\xa9\xf9\x13\x40\xf9\x5e\x8e\x5f\xf8\xff\x83\x01\x91\xc0\x03\x5f\xd6\x56\x16\x06\x94"
    #define SIGNATURE_SET_DEV_CLASS "\x5e\x86\x00\xf8\xfd\x7b\xbf\xa9\xfd\x03\x00\x91\xe1\x03\x00\xaa\xe0\x03\x1f\xaa\x06\x00\x00\x94\x1f\x00\x00\x71\xe0\x17\x9f\x1a\xfd\x7b\xc1\xa8\x5e\x8e\x5f\xf8\xc0\x03\x5f\xd6"
#else
    #define LIBC_PATH_OLD           "/system/lib/libc.so"
    #define LIBC_PATH_NEW           "/apex/com.android.runtime/lib/bionic/libc.so"
//  QTI:
//    #define LIBRARY_PATH            "/system/system_ext/lib/libbluetooth_qti.so"
//    #define SIGNATURE_GET_DEV_CLASS "\xe9\xf0\x4f\x89\xb0\x07\x46\x8f\x48\x78\x44\xd0\xf8\x00\x80\xd8\xf8\x00\x00\x08\x90\x38\x68\x08\x28\x00\xf0\x99\x80\x03\x28\x1d\xd0\x02\x28\x40\xf0\xb4\x80\xbc\x68\x93\xf7\x65\xfc\x05\x46\x00\x68\x80\x47\x85\x49\x00\x28\x79\x44\x00\xf0\xbb\x80\x8e\x4a\x06\x20\x8e\x4b\x06\x26\x7a\x44\x7b\x44\x1b\xf1\x54\xed\x68\x68\x80\x47\x81\x88\x00\x68\x20\x60\xa1\x80\x7e\x60\xe8\xe0\xcd\xe9\x02\x78\xd7\xf8\x08\xb0\xca\xf7\xb1\xfb\x0e\x46\x7f\x49\x80\x4a\x05\x46\x80\x4b\x79\x44\x7a\x44\xcd\xe9\x00\x06\x7b\x44\x04\x20\x1b\xf1\x38\xed\x04\xaf\x4f\xf0\x00\x0a\x00\x20\x00\x21\x00\x24\x11\xe0\x1a\xf1\x43\xfd\x0b\xeb\x04\x10\x67\xf9\xcf\x0a\x01\x34\x40\xf9\x0f\x0a\x19\xf1\x01\x00\x48\xf1\x00\x01\xb9\xf1\x21\x02\x78\xf1\x00\x02\x45\xd2\x81\x46\x88\x46\xc9\xf1\x20\x01\x25\xfa\x00\xf0\x06\xfa\x01\xf1\x08\x43\xb9\xf1\x20\x01\x26\xfa\x01\xf1\x48\xbf\x01\x46\xc8\x07\xe5\xd0\xb9\xf1\x03\x00\x68\xf1\x00\x41\xd0\xf1\x15\x02\x21\xf0\x00\x41\x7a\xeb\x01\x01\xda\xd3\xdf\xe8\x00\xf0\x1c\x1b\x17\x0b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x20\x1b\x1b\x1b\x1b\x1b\x24\x38\x46\x41\xf2\x1f\x11\x1a\xf1\x05\xfd\x0b\xeb\x04\x10\x67\xf9\xcf\x0a\x01\x34\x40\xf9\x0f\x0a\x38\x46\x41\xf2\x12\x11\xb4\xe7\xbc\xe7\x38\x46\x41\xf2\x0a\x11\xaf\xe7\x38\x46\x41\xf2\x0b\x11\xab\xe7\x38\x46\x41\xf2\x1e\x11\xa7\xe7\x02\x99\x20\x01\x00\x25\xdd\xf8\x0c\x80\x48\x60\x70\xe0\x42\x48\x78\x44\x00\x68\xbc\xf0\xb5\xfc\x05\x46\x00\x20\x78\x60\x00\x21\x04\x95\x04\xa8\x00\xf0\x8b\xf8\x3d\x48\x78\x44\x00\x68\x04\x78\x28\x46\xbc\xf0\x24\xfe\x3a\x49\x03\x46\x3a\x4a\x40\xf2\x04\x50\x79\x44\x05\x2c\x7a\x44\x24\xd3\x44\xf7\xed\xfe\x23\xe0\x00\x20\x39\x46\x00\x25\x00\xf0\xdf\xf9\x00\x28\x49\xd1\x08\x98\xd8\xf8\x00\x10\x08\x1a\x4d\xd1\x38\x46\x09\xb0\xbd\xe8\xf0\x4f\xcf\xf7\x04\xb8\x26\x4a\x06\x20\x26\x4b\x7a\x44\x7b\x44\x1b\xf1\x9a\xec\x25\x48\x01\x25\x78\x44\x00\x68\x81\x88\x00\x68\x20\x60\xa1\x80\x2e\xe0\x44\xf7\x58\xff\x28\x46\xbc\xf0\xf1\xfd\x20\xb3\x28\x46\xbc\xf0\xed\xfd\x00\xeb\x40\x00\x40\x00\x78\x60\xba\xf0\x0d\xfc\x06\x46\xb8\x60\x28\x46\xbc\xf0\x5a\xfd\x04\x46\x28\x46\xbc\xf0\x78\xfd\x84\x42\x10\xd0\x20\x46\xbc\xf0\x95\xfd\x81\x88\x00\x68\x30\x60\x20\x46\xb1\x80\xbc\xf0\xb0\xfd\x04\x46\x28\x46\xbc\xf0\x68\xfd\x06\x36\x84\x42\xee\xd1\x28\x46\xbc\xf0\x5a\xfc\x00\x25\x08\x98\xd8\xf8\x00\x10\x08\x1a\x03\xd1\x28\x46\x09\xb0\xbd\xe8\xf0\x8f\x1b\xf1\x66\xec\xda\x46\x25\x12\x00\x58\x31\xed\xff\xe8\x18\xf2\xff\x30\xe8\xef\xff\xae\x23\x12\x00\x46\x25\x12\x00\xfc\x23\x12\x00\x91\xd2\xf0\xff\x66\xe8\xef\xff\x1c\x31\xed\xff\xb8\x74\xf0\xff\x70\xe9\xef\xff\x5a\x31\xed\xff\xa4\xe9\xef\xff\x2d\xe9"
//    #define SIGNATURE_SET_DEV_CLASS "\xb5\x01\x46\x00\x20\x00\xf0\x05\xf8\xb0\xfa\x80\xf0\x40\x09\x80\xbd\xd4\xd4\x2d"
//  AOSP:
    #define LIBRARY_PATH            "/system/lib/libbluetooth.so"
    #define SIGNATURE_GET_DEV_CLASS "\xe9\xf0\x47\xad\xf5\x1a\x7d\x81\x46\x6c\x48\x78\x44\xd0\xf8\x00\x80\xd8\xf8\x00\x00\x99\x90\xd9\xf8\x00\x00\x08\x28\x21\xd0\x03\x28\x47\xd0\x02\x28\x40\xf0\x95\x80\xd9\xf8\x08\x40\x84\xf7\xbb\xfb\x05\x46\x00\x68\x80\x47\x61\x49\x00\x28\x79\x44\x00\xf0\xac\x80\x69\x4a\x06\x20\x69\x4b\x06\x26\x7a\x44\x7b\x44\x17\xf2\xb0\xe8\x68\x68\x80\x47\x81\x88\x00\x68\x20\x60\xa1\x80\xc9\xf8\x04\x60\x8d\xe0\x02\xad\x4f\xf4\x17\x71\x28\x46\x16\xf2\x04\xee\x28\x46\x00\x21\x00\xf0\xbc\xf8\x55\x48\x78\x44\x00\x68\x00\x78\x05\x28\x08\xd3\x53\x49\x40\xf2\x04\x50\x53\x4a\x02\x9b\x79\x44\x7a\x44\xab\xf0\xaf\xfc\x02\x98\x00\x28\x00\xf0\x71\x80\x00\xeb\x40\x00\x29\x1d\x42\x00\xd9\xf8\x08\x00\xc9\xf8\x04\x20\x16\xf2\xd8\xed\x65\xe0\xd9\xf8\x08\xa0\xd5\xf7\xba\xf9\x47\x49\x05\x46\x47\x4a\x48\x4b\x79\x44\x7a\x44\x00\x90\x7b\x44\x04\x20\x17\xf2\x70\xe8\x02\xae\x00\x24\x00\x27\x0b\xe0\x76\xf1\x8f\xf9\x0a\xeb\x07\x10\x66\xf9\xcf\x0a\x01\x37\x40\xf9\x0f\x0a\x01\x34\x21\x2c\x43\xd0\x25\xfa\x04\xf0\xc0\x07\xf8\xd0\xe0\x1e\x15\x28\xf5\xd8\xdf\xe8\x00\xf0\x1c\x1b\x17\x0b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x1b\x20\x1b\x1b\x1b\x1b\x1b\x24\x30\x46\x41\xf2\x1f\x11\x76\xf1\x6c\xf9\x0a\xeb\x07\x10\x66\xf9\xcf\x0a\x01\x37\x40\xf9\x0f\x0a\x30\x46\x41\xf2\x12\x11\xcf\xe7\xd7\xe7\x30\x46\x41\xf2\x0a\x11\xca\xe7\x30\x46\x41\xf2\x0b\x11\xc6\xe7\x30\x46\x41\xf2\x1e\x11\xc2\xe7\x00\x20\x49\x46\x00\x25\x00\xf0\xc3\xf9\x80\xb9\x99\x98\xd8\xf8\x00\x10\x08\x1a\x01\xbf\x48\x46\x0d\xf5\x1a\x7d\xbd\xe8\xf0\x47\xd9\xf7\x9e\xb8\x0d\xe0\x38\x01\xc9\xf8\x04\x00\x00\x25\x99\x98\xd8\xf8\x00\x10\x08\x1a\x02\xbf\x28\x46\x0d\xf5\x1a\x7d\xbd\xe8\xf0\x87\x16\xf2\x1c\xef\x0a\x4a\x06\x20\x0a\x4b\x7a\x44\x7b\x44\x17\xf2\x04\xe8\x08\x48\x01\x25\x78\x44\x00\x68\x81\x88\x00\x68\x20\x60\xa1\x80\xe3\xe7\x00\xbf\x38\x2f\x22\x00\x31\x1f\xeb\xff\xcb\x86\xef\xff\xc9\x93\xed\xff\xa0\x2d\x22\x00\x36\x30\x22\x00\x3e\x18\xed\xff\xdb\x94\xed\xff\xa9\x1e\xeb\xff\x4b\x6a\xec\xff\xa1\x94\xed\xff\x33\x1f\xeb\xff\x1f\x95\xed\xff\x2d\xe9\xf0\x4f\x81"
    #define SIGNATURE_SET_DEV_CLASS "\xb5\x01\x46\x00\x20\x00\xf0\x05\xf8\xb0\xfa\x80\xf0\x40\x09\x80\xbd\xd4\xd4\x2d"
#endif

#define DEV_CLASS_LEN 3

typedef uint8_t dev_class_t[DEV_CLASS_LEN];

typedef struct {
    int type = 0x4;
    int len = DEV_CLASS_LEN;
    void* val;
} dev_class_property_t;

class BluetoothPlusPlus {
private:
    pid_t pid;
    long remoteBaseAddress;
    long scanSize;
    char* memory;

public:
    BluetoothPlusPlus();
    ~BluetoothPlusPlus();
    int getDeviceClass(dev_class_t *deviceClass);
    int setDeviceClass(dev_class_t *deviceClass);
};

#endif //BLUETOOTH_BLUETOOTHPLUSPLUS_H
